<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>IOT결합 자동 디스펜서</title>
    <link rel="stylesheet" href="./style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>

  <body>
    <header>IOT결합 자동 디스펜서</header>
    <div class="after"></div>

    <div class="container">
      <div class="left-panel" style="background-color: #ffffff; padding-top: 20px;">
        <div class="tab">
          <h3 style="margin-top: 10px;">규격 종류</h3>
          <div id="bottle-list"></div>
        </div>
      </div>

      <div class="right-panel" style="padding-top: 20px;">
        <div class="tab" style="padding: 20px";>
          <h2>(매장이름)</h2>
          <div style="width: 100%; max-width: 700px; margin: 0 auto; padding: 16px;"></div>
          <canvas id="myChart" style="display: inline;"></canvas>
          </div>
          <script>
              const ctx = document.getElementById('myChart').getContext('2d');
              const myChart = new Chart(ctx, {
                  type: 'line',
                  data: {
                      labels: ['1월', '2월', '3월', '4월', '5월', '6월'],
                      datasets: [
                          {
                              label: '불고기소스',
                              data: [120, 150, 180, 170, 160, 190],
                              borderColor: 'rgba(189, 110, 70, 55)',
                              backgroundColor: 'rgba(255, 99, 132, 0.2)',
                              tension: 0.3
                          },
                          {
                              label: '머스타드',
                              data: [80, 100, 130, 120, 140, 160],
                              borderColor: 'rgba(255, 202, 24, 1)',
                              backgroundColor: 'rgba(255, 206, 86, 0.2)',
                              tension: 0.3
                          },
                          {
                              label: '케찹',
                              data: [90, 110, 150, 140, 150, 170],
                              borderColor: 'rgba(218, 16, 57, 1)',
                              backgroundColor: 'rgba(255, 159, 64, 0.2)',
                              tension: 0.3
                          },
                          {
                              label: '데리야끼',
                              data: [100, 130, 160, 150, 170, 180],
                              borderColor: 'rgba(255, 179, 112, 1)',
                              backgroundColor: 'rgba(54, 162, 235, 0.2)',
                              tension: 0.3
                          }
                      ]
                  },
                  options: {
                      responsive: true,
                      scales: {
                          y: {
                              beginAtZero: true
                          }
                      }
                  }
              });
          </script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAUVSpDLXhU8Xu47q9KMoXlI8f8ozWtKNo",
    authDomain: "cus-be8f0.firebaseapp.com",
    databaseURL: "https://cus-be8f0-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "cus-be8f0",
    storageBucket: "cus-be8f0.firebasestorage.app",
    messagingSenderId: "322803967928",
    appId: "1:322803967928:web:f6130455c7ddb49e4d114d",
    measurementId: "G-H3K3ZHKDV7"
  };

  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();
  const sourcesRef = database.ref('/');

  const bottleList = document.getElementById('bottle-list');

function renderBottles(data) {
  bottleList.innerHTML = "";

  Object.keys(data).forEach(key => {
    const item = data[key];

    if (item && typeof item.uid !== 'undefined' && typeof item.weight !== 'undefined') {
      const div = document.createElement('div');
      div.style.backgroundColor = '#f0f0f0';
      div.style.padding = '10px';
      div.style.marginBottom = '10px';
      div.style.borderRadius = '8px';
      div.style.fontSize = '22px';
      div.style.cursor = 'pointer';

      const displayName = item.name && item.name.trim() !== ''
        ? `<strong>${item.name}</strong>`
        : `<strong>${item.uid} / ${key}</strong>`;

      div.innerHTML = `
        <div>${displayName}</div>
        <div style="color: #555; font-size: 18px;">weight: ${item.weight}</div>
      `;

      div.onclick = () => {
        openModal(key, item.name || '');
      };

      bottleList.appendChild(div);
    }
  });
}

  sourcesRef.on('value', snapshot => {
    const data = snapshot.val();

    if (data) {
      renderBottles(data);
    } else {
      bottleList.innerHTML = "<p>데이터가 없습니다.</p>";
    }
  });
</script>

<script>
let currentEditKey = null; // 현재 수정 중인 UID

function openModal(key, currentName = '') {
  currentEditKey = key;
  const modal = document.getElementById('modal');
  const input = document.getElementById('sourceNameInput');

  input.value = currentName || '';
  modal.style.display = 'block';
}

function closeModal() {
  document.getElementById('modal').style.display = 'none';
  currentEditKey = null;
}

function saveModalName() {
  const newName = document.getElementById('sourceNameInput').value.trim();

  if (newName && currentEditKey) {
    const itemRef = database.ref(`/${currentEditKey}`);
    itemRef.update({ name: newName })
      .then(() => {
        alert('저장되었습니다.');
        closeModal();
      })
      .catch(error => {
        console.error('저장 실패:', error);
        alert('저장에 실패했습니다.');
      });
  } else {
    alert('이름을 입력해주세요.');
  }
}
</script>

<div id="modal" class="modal">
  <div class="modal-content">
    <span class="close-button" onclick="closeModal()">&times;</span>
    <h3>소스 이름 입력</h3>
    <input type="text" id="sourceNameInput" placeholder="소스 이름" />
    <button onclick="saveModalName()">저장</button>
  </div>
</div>
  </body>
</html>